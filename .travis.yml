language: generic
os:
  - linux
  - osx
sudo: required
services:
  - docker
before_install:
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then export TARGET_NAME=darwin-x64; fi
  - if [ "$TRAVIS_OS_NAME" = "linux" ]; then export TARGET_NAME=linux-x64; fi
  - nvm install --lts
  - nvm use --lts
  - node -v
  - npm install -g esy@latest
before_script:
  - esy install
script:
  - esy
  - esy build
  - mv _esy/default/build/default/executable/ReCreateAppApp.exe re-create-app
  - esy npm-release
  - cd _release
  - echo "Releasing app $(node -v) ..."
jobs:
  include:
    - stage: npm release
      node_js: "7"
      script:
        - echo "Publishing to npm ..."
        - npm publish
      deploy:
        provider: npm
        email: pawlic7@gmail.com
        api_key:
          secure: djGgadoG8xZ7Lm5YWqq+R1yaiUDu2rJ32jvP5GvM3ucbU6Vsjkjrs/9jxx6jGyJpZevaztaVqOU8QwC/fHZ4xQJ41LfuV3CJfcMQeCJKfsU5T/ZrtN0pUhjoA5KJYqUyvUPmq/SehFhqkySIcn+wMOhKQSV+/6OUV9T5wCWn78/YAwHZ2+Y3xJbjKSOUR5oMAisdLScJGWPO8G6FCWOu8bocIsGJRavd5rL8BuKe2xgSaZUdIEC8LkS7bK2+7fssL6aLdECg7QSljjvpcNdVi7nSN09ScatIhcDDBNJwExaDRZEJCmINl0ZogrI04jaLinpe2YmdXuJg8VVj9xO1rMbLsyY1vGCuKCr5WOFxGherMFKSUzeiEBJpCWtcUwb3cbdMavITTgcpHU7yBQJGr+bGrYhgBYCTkPmt9FpbIibINx/PiyqN0d4LXy55IN+K8+5qmL607o4/TwRoDeaYDwvWTo4GEU59NNdbZf0HjyY1BBwtrw1vVg3sOinAjgt6kdVEfPwFF5oxJ0MjqeuyzJ82Kk17oRi6wFytM06UZV1IRfD89gQ6fhPIIwb1tuJKNKOTYuoftifnBuHF1VyEqtL9EPJESTOK+i8GOm0BwBcrvp7NHR/6Dfe0wmk5gH8s6n9pkOdl6rRP82xzIYvkr+IVifmFBjmKn8xt+aFm6QQ=
        skip_cleanup: true
        on:
          tags: true
